---==========================---
---Total Patients - Cohort 1B
---==========================---

---===============================================================================================================---
---1.1. Patients with â‰¥1 claim for augmentation therapy during the study period; index date is date of first claim---
---===============================================================================================================---

---Here study period is the complete data

SELECT * FROM PRJ_XPLR_MKTSCAN_STD_A_STG.marketscan_std_a_ndc_events_all_insurances_for_requests_202503 LIMIT 10;

CREATE OR REPLACE TABLE PRJ_XPLR_MKTSCAN_STD_A_STG.AATD_EMP_PATS_AUG_THERAPY_SG_1 AS
WITH TBL1 AS (
SELECT A.*
FROM PRJ_XPLR_MKTSCAN_STD_A_STG.AATD_EMP_PATS_LIVER_SG AS A
INNER JOIN 
     PRJ_XPLR_MKTSCAN_STD_A_STG.marketscan_std_a_ndc_events_all_insurances_for_requests_202503 AS B
   ON A.ENROLID = B.ENROLID
WHERE B.NDC IN ('13533070002', '00026060135', '00026060130', '00053720102', '00053720302', '00053721101', '00053721201', '00053721301', '00053765312', '00053765320', '00053765380',
'00161060135', '00192060130', '00192060135', '00338280101', '00338280102', '00530720102', '00530765320', '00537020202', '00537020302', '00944280101', '00944280102',
'00944280201', '00944280202', '00944280303', '00944280404', '00944281201', '00944281401', '00944281501', '00944282202', '00944288401', '00944288402', '00944288403',
'00944288404', '00944288405', '00944288406', '04959110502', '13533000006', '13533020020', '13533060130', '13533060135', '13533070001', '13533070011', '13533070101',
'13533070211', '13533070310', '13533070501', '13533070511', '13533070531', '13533070532', '13533070551', '13533070552', '13533070622', '24558280201', '24558280202',
'49669580001', '49669580002', '52919001412', '57516010102', '57516010201', '57516010320', '57516011002', '57516011101', '57516011220', '57516011302', '57516011401',
'57516011520', '64764051825', '64764051950', '76297000222')
),
TBL2 AS (
SELECT A.*
FROM PRJ_XPLR_MKTSCAN_STD_A_STG.AATD_EMP_PATS_LIVER_SG AS A
INNER JOIN 
     PRJ_XPLR_MKTSCAN_STD_A_STG.marketscan_std_a_procedure_events_all_insurances_pos_for_requests_202503 AS B
   ON A.ENROLID = B.ENROLID
WHERE B.PROC IN ('J0256', 'J0257', 'S9346')
),
TBL3 AS (
SELECT * FROM TBL1
UNION ALL
SELECT * FROM TBL2
)
SELECT DISTINCT * FROM TBL3;

SELECT COUNT(*) AS CNT, COUNT(DISTINCT ENROLID) AS PATS
FROM PRJ_XPLR_MKTSCAN_STD_A_STG.AATD_EMP_PATS_AUG_THERAPY_SG_1;

--CNT	PATS
--137	137

SELECT * FROM PRJ_XPLR_MKTSCAN_STD_A_STG.AATD_EMP_PATS_AUG_THERAPY_SG_1 LIMIT 10;
